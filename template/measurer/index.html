<!DOCTYPE html>
{% load static %}
{% csrf_token %}
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="./assets/img/favicon.png">
    <title>
        Замерщик
    </title>
    <!-- CSS Files -->
    <link href="{% static 'argon-dashboard.css' %}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
</head>


<div class="min-height-100 bg-primary position-absolute w-100"></div>
<main class="main-content position-relative border-radius-lg ">
    <h2>Привет, {{ user.first_name |default:'Гость' }} {{ user.last_name}} ( {{ user.username}} ) </h2>


    {% if user.is_authenticated %}
    <a href="{% url 'logout' %}">Нажми чтобы выйти</a>
    <div class="col-lg-12 mb-lg-0 mb-4 mt-5">
        <div class="card ">
            <div class="card-header pb-0 p-3">
                <div class="d-flex justify-content-between">
                    <h6 class="mb-2">Замеры</h6>
                </div>
                <form>
                    <p class="d-flex justify-content-start " style="padding: 20px"><input type="date" name="calendar"
                                                                                          style="height: 40px;width:150px">
                        <input type="submit" class=" btn bg-gradient-secondary mx-2" style="width:200px"></p>
                </form>
            </div>
            <div class="row align-items-center" style="margin:20px">
                 {% for el in all_measurements %}
                <div class="col-3 col-lg-1 col-md-2">
                    <div class="card row" style="border-radius:4px;padding:2px;">
                        <div class="card-body p-3">
                            <p class="justify-content-center row" style="text-align:center; font-size:14px;">
                                {{ el  }}
                            <p>
                        </div>
                    </div>
                </div>


                {% endfor %}
            <div class="container-fluid row">
                {% for el in curr_measurements %}
                <div class="col-xl-4 col-sm-6" data-aos="fade-up" data-bs-toggle="modal"
                     data-bs-target="#modalMeasurement{{el.pk}}">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <form method="post" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="col-lg-12">
                                        <div class="numbers">
                                            <p class="text-sm mb-0 text-uppercase font-weight-bold"></p>
                                            <h4 class="mb-0">

                                                <span>   {{ el.client }}</span>

                                            </h4>
                                            <h6 class="mb-0">
                                                Адрес:
                                                <span>   {{ el.address }}</span>

                                            </h6>
                                            <h6 class="mb-0">
                                                Номер телефона:
                                                <span>   {{ el.number }}</span>
                                            </h6>

                                            <h6 class="mb-0">
                                                Дата замера:
                                                <span>   {{ el.date }}</span>
                                            </h6>
                                            <h6 class="mb-0">
                                                Время замера:
                                                <span>   {{ el.time }}</span>
                                            </h6>
                                            <h6>
                                                Комментарий:
                                                <span>   {{ el.comment }}</span>
                                            </h6>
                                            <fieldset disabled>
                                                <h6>
                                                    Предварительная сумма:
                                                    <span>   {{ el.preliminary_amount }}</span>
                                                </h6>
                                            </fieldset>
                                            <h6>
                                                Окончательная сумма:
                                                <span>   {{ el.final_amount }}</span>
                                            </h6>
                                            <p style="font-size:12px"> Кто создал: <span
                                                    style="font-size:14px;font-weight:800">{{ el.manager }} {{ el.time_create }} </span>
                                                <br>
                                                Исполнитель: <span style="font-size:14px;font-weight:800">{{ el.executor }} </span>
                                                <br>
                                                Обновлено последний раз: <span
                                                        style="font-size:14px;font-weight:800">{{ el.who_updated }} {{ el.time_updated }}  </span>
                                            </p>
                                        </div>
                                        <div class="row">
                                            {% if el.status == "0" %}
                                            <button type="button" class="btn bg-gradient-light btn-sm"> Активная
                                                заявка
                                            </button>

                                            {% elif el.status == "1" %}
                                            <button type="button" class="btn bg-gradient-success btn-sm"> Договор
                                            </button>

                                            {% elif el.status == "2" %}
                                            <button type="button" class="btn bg-gradient-secondary btn-sm"> Думает
                                            </button>

                                            {% elif el.status == "3" %}
                                            <button type="button" class="btn bg-gradient-primary btn-sm"> Придет на
                                                офис
                                            </button>
                                            {% elif el.status == "4" %}
                                            <button type="button" class="btn bg-gradient-info btn-sm"> Банковская
                                                рассрочка
                                            </button>

                                            {% elif el.status == "5" %}
                                            <button type="button" class="btn bg-gradient-warning btn-sm"> Отказ до
                                                замера
                                            </button>

                                            {% elif el.status == "6" %}
                                            <button type="button" class="btn bg-gradient-danger btn-sm"> Отказ после
                                                замера
                                            </button>


                                            {% endif %}

                                        </div>

                                    </div>

                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal fade " id="modalMeasurement{{el.pk}}" tabindex="-1"
                     aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class=" modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">

                                <fieldset disabled>

                                    <h6>Замер №</h6>
                                    <input type="text" id="disabledTextInput" value="{{ el.pk }}">


                                </fieldset>
                            </div>
                            <div class="modal-body row">
                                <div class="col-sm-12">

                                    <input type="text" style="display:none" name="pk" value="{{ el.pk }}">
                                    <h6 class="title-group">Имя клиента:</h6>
                                    <input type="text" name="client" value="{{ el.client }}">
                                    <h6 class="title-group">Номер телефона:</h6>
                                    <input type="text" name="number" value="{{ el.number }}">
                                    <h6 class="title-group">Адрес замера:</h6>
                                    <input type="text" name="address" value="{{ el.address }}">
                                    <h6 class="title-group">Дата замера:</h6>
                                    <input type="date" name="calendarMeasurement"
                                           value="{{ el.date|date:'Y-m-d' }}" style="height: 40px">
                                    <h6 class="title-group">Время замера:</h6>
                                    <input type="text" name="time" value="{{ el.time }}">
                                    <h6 class="title-group">Комментарий:</h6>
                                    <input type="text" name="comment" value="{{ el.comment }}">
                                    <h6 class="title-group">Окончательная сумма:</h6>
                                    <input type="text" name="final_amount" value="{{ el.final_amount }}">
                                    <h6 class="title-group">Переназначить замер:</h6>
                                    <select class="form-select form-select-lg" name="selectMeasurers">
                                        <option value="0">Выберите исполнителя</option>
                                        {% for el in measurers %}
                                        <option value="{{ el.pk }}">{{ el.first_name }} {{ el.last_name }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                    <fieldset disabled>
                                        <h6 class="title-group">Прикрепленный файлы:</h6>
                                        <input type="text" value="{{ el.agreements }}">
                                    </fieldset>
                                    {{ form.as_p }}

                                    <select class="form-select form-select-lg mt-3 mb-3" name="select">
                                        <!--Supplement an id here instead of using 'name'-->
                                        <option value="0">Активная заявка</option>
                                        <option value="1">Договор</option>
                                        <option value="2">Думает</option>
                                        <option value="3">Придет на офис</option>
                                        <option value="4">Банковская рассрочка</option>
                                        <option value="5">Отказ до замера</option>
                                        <option value="6">Отказ после замера</option>
                                    </select>


                                </div>

                            </div>

                            {% if user.is_superuser %}

                            <div class="modal-footer">
                                <button type="button" class="btn btn-dark" data-bs-dismiss="modal">Закрыть</button>
                                <button type="submit" class="btn btn-success">Сохранить</button>

                                <a class="btn btn-secondary" data-bs-toggle="modal" href="#exampleModal{{el.pk}}"
                                   role="button" data-bs-dismiss="modal">Открыть логи</a>
                            </div>

                            {% else %}
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть
                                </button>
                                <button type="submit" class="btn btn-primary">Сохранить</button>
                            </div>

                            {% endif %}


                        </div>
                    </div>

                </div>
                </form>
                <div class="modal fade" id="exampleModal{{el.pk}}" aria-hidden="true"
                     aria-labelledby="exampleModalToggleLabel" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalToggleLabel">Modal 1</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {{ el.logs }}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-dark" data-bs-target="#exampleModalToggle"
                                        data-bs-toggle="modal" data-bs-dismiss="modal">Закрыть
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                {% endfor %}
            </div>
        </div>
    </div>

    {% else %}
    <a href="{% url 'login' %}">Авторизироваться</a>
    {% endif %}
</main>
</html>

<style>
.title-group {
margin-top: 5px;
margin-bottom: 5px;
}
input 				{
  font-size:18px;
  padding:10px 10px 10px 5px;
  display:block;
  width:100%;
  border:none;
  border-bottom:1px solid #757575;
}
input:focus 		{ outline:none; }
















</style>
